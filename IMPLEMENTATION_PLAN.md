# IMPLEMENTATION PLAN â€” GARCEA

## Overview

This plan maps REQUIREMENTS.md to implementation tasks.
Sections between AUTO markers are regenerated by `tools/gen_plan.py`.
Add manual notes outside these markers.

---

<!-- PLAN:AUTO:BEGIN -->

*Auto-generated on 2025-11-25 13:57*

## Scope Matrix

- **In Scope (FR)**: FR-001, FR-002, FR-003, FR-004, FR-005, FR-006, FR-007, FR-008, FR-009, FR-010, FR-011, FR-012, FR-013
- **In Scope (NFR)**: NFR-001, NFR-002, NFR-003, NFR-004, NFR-005, NFR-006, NFR-007, NFR-008, NFR-009, NFR-010
- **Out of Scope**: OOS-001, OOS-002, OOS-003, OOS-004, OOS-005, OOS-006, OOS-007, OOS-008, OOS-009, OOS-010
- **Specifications**: SPEC-001, SPEC-002, SPEC-003, SPEC-004, SPEC-005, SPEC-006, SPEC-007, SPEC-008, SPEC-009
- **Open Questions**: Q-001, Q-002, Q-003, Q-004, Q-005, Q-006, Q-007, Q-008, Q-009, Q-010, Q-011, Q-012, Q-013, Q-014, Q-015, Q-016

## Open Questions

**Resolve these before implementation:**

- [ ] **Q-001**: Which database technology should we use for direct frontend access?
- [ ] **Q-002**: Should Target values be editable via Tracker, or only Admin?
- [ ] **Q-003**: What happens if user navigates away with unsaved changes?
- [ ] **Q-004**: Should PDF reports include historical trends (multi-month)?
- [ ] **Q-005**: Is there a need for data backup/export for disaster recovery?
- [ ] **Q-006**: Should the Dashboard show all months simultaneously, or just current month?
- [ ] **Q-007**: Do we need role-based permissions (viewer vs editor)?
- [ ] **Q-008**: What should happen when Target is 0 (division by zero in status calculation)?
- [ ] **Q-009**: Should we support custom status colors/thresholds per Objective?
- [ ] **Q-010**: Is there a need to archive or soft-delete Objectives instead of permanent del...
- [ ] **Q-011**: What date range configuration approach?
- [ ] **Q-012**: What happens when timeline ends (post Dec 2026)?
- [ ] **Q-013**: How to handle unconfigured KRs (Target=0)?
- [ ] **Q-014**: Keyboard shortcuts needed?
- [ ] **Q-015**: Should we include sample data?
- [ ] **Q-016**: Browser storage limit warnings?

## Requirements Mapping

### Functional Requirements

**FR-001**: Data Model: Objectives and Key Results

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-001**: Data Model âœ… Complete

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-002**: Dashboard View (Main Screen)

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-002**: Dashboard View âœ… Complete

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-003**: Admin Page (OKR Structure Management)

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-003**: Admin Page âœ… Partial (simplified target management)

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-004**: Tracker Page (Monthly Data Entry)

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-004**: Tracker Page âœ… Complete

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-005**: PDF Report Generation âœ… Complete

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-005**: PDF Report Generation

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-006**: Data Initialization âœ… Complete

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-006**: Data Initialization

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-007**: Data Persistence âœ… Complete

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-007**: Data Persistence and Loading

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-008**: Responsive Design âœ… Complete

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-008**: Responsive Design

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-009**: Data Export/Import (JSON backup)

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-009**: Data Export/Import (Backup & Recovery)

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-010**: Keyboard Shortcuts & Accessibility

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-010**: Keyboard Shortcuts

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-011**: Sample Data & Demo Mode

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-012**: Storage Management & Warnings (partial - structure exists)

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-012**: Storage Management & Warnings

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-013**: Timeline Configuration & End-of-Period Handling

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

**FR-013**: Timeline Configuration âœ… Complete

- [ ] Define implementation approach
- [ ] Write tests (happy path + edge cases)
- [ ] Implement solution
- [ ] Update module README

### Non-Functional Requirements

| ID | Requirement | Status |
|----|-------------|--------|
| NFR-001 | Performance | â¸ï¸ Pending |
| NFR-002 | Reliability | â¸ï¸ Pending |
| NFR-003 | Usability | â¸ï¸ Pending |
| NFR-004 | Data Integrity | â¸ï¸ Pending |
| NFR-005 | Browser Support | â¸ï¸ Pending |
| NFR-006 | Accessibility | â¸ï¸ Pending |
| NFR-007 | Code Quality | â¸ï¸ Pending |
| NFR-008 | Documentation | â¸ï¸ Pending |
| NFR-009 | Testing | â¸ï¸ Pending |
| NFR-010 | Scalability | â¸ï¸ Pending |

## Standard Development Workflow

Follow these steps for each feature/requirement:

1. Read REQUIREMENTS.md, confirm scope (only FR/NFR in file).
2. Resolve all Open Questions; block implementation until answers provided.
3. Write failing tests for each FR (TDD approach).
4. Implement minimal solution to satisfy tests.
5. Add per-module READMEs (Design/Features/Usage).
6. Wire CLI/API only if explicitly required by FR/NFR.
7. Validate NFRs (performance, security, coverage >= 90%).
8. Run `python3 tools/requirements_guard.py` to validate alignment.
9. Update documentation and changelog.
10. Commit with conventional commits (feat:, fix:, docs:).

## Test Plan

- Each FR must have **at least one happy-path and one edge-case test**
- Target: **>= 90% code coverage**
- Use descriptive test names: `test_<function>_<behavior>`
- Mock external dependencies (Jira MCP, Azure OpenAI, email)

## Acceptance Criteria

âœ… Implementation is complete when:

- [ ] All FR/NFR IDs mapped and implemented
- [ ] No features beyond REQUIREMENTS.md implemented (OOS respected)
- [ ] All tests passing with >= 90% coverage
- [ ] `python3 tools/requirements_guard.py` passes
- [ ] All module READMEs updated
- [ ] No linter errors (`ruff check .`)
- [ ] Code formatted (`black .`)
- [ ] Type hints validated (`mypy src/py`)

<!-- PLAN:AUTO:END -->








---

## Manual Notes

### âœ… All Open Questions Resolved (November 24, 2025)

All Q-001 through Q-016 have been **RESOLVED** in REQUIREMENTS.md.

---

## Complete Technology Stack

### Frontend Stack

```
Vite + React 18 + TypeScript (strict mode)
â”œâ”€â”€ Routing: React Router v6
â”œâ”€â”€ Database: sql.js (SQLite in browser â†’ IndexedDB persistence)
â”œâ”€â”€ State: React Context + Custom Hooks
â”œâ”€â”€ Forms: React Hook Form + Zod validation
â”œâ”€â”€ Styling: Tailwind CSS
â”œâ”€â”€ Components: Headless UI (accessible)
â”œâ”€â”€ Dates: date-fns
â”œâ”€â”€ PDF: pdfmake
â”œâ”€â”€ Notifications: Sonner (toast)
â”œâ”€â”€ Utils: use-debounce (auto-save)
â”œâ”€â”€ Testing: Vitest + React Testing Library
â””â”€â”€ Deployment: Local dev (Phase 1) â†’ Azure Static Web Apps (Phase 2)
```

### Technical Decisions Summary

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **State Management** | React Context + Custom Hooks | Simple data flow, no Redux needed |
| **Form Library** | React Hook Form | Best performance, TypeScript support |
| **Validation** | Zod | TypeScript-first, auto-type inference |
| **Routing** | React Router v6 | Industry standard, excellent docs |
| **Date Handling** | date-fns | Tree-shakable, immutable |
| **Auto-Save** | Debounced 500ms | Better UX, fewer writes |
| **Multi-Tab Sync** | Independent (Phase 1) | Keep simple, add later if needed |
| **Error Notifications** | Sonner | Modern, lightweight (3.5KB) |
| **CI/CD** | Phase 2: GitHub Actions | Focus on features first |
| **sql.js Persistence** | Manual save after mutations | Explicit control, better error handling |

### Key Architecture Decisions

1. **Direct Database Access**: No backend API - React components query sql.js directly
2. **Explicit Persistence**: Save to IndexedDB after every mutation + periodic auto-backup (5min)
3. **Data Safety**: JSON export/import for backup/recovery with version handling
4. **Targets Management**: Set in Admin only (OKR best practice), read-only in Tracker
5. **Timeline Flexibility**: Configurable date range via environment variables
6. **TDD Approach**: Write tests alongside implementation (not at the end)

---

## Implementation Phases (Detailed)

### Phase 1: Core Foundation (MVP)
**Goal:** Functional OKR tracker with basic CRUD operations
**Timeline:** ~40-50 hours

#### 1.1 Project Setup (~2-3 hours)
- [ ] Initialize Vite + React + TypeScript project
- [ ] Install core dependencies (see package.json below)
- [ ] Configure tsconfig.json (strict mode)
- [ ] Set up Tailwind CSS + PostCSS
- [ ] Configure Vitest + React Testing Library
- [ ] Create .env.example with START_DATE, END_DATE
- [ ] Set up ESLint + Prettier
- [ ] Test: Build and run dev server

#### 1.2 Database Layer (FR-001, FR-007) (~5-7 hours)
- [ ] Install sql.js, configure WASM loading
- [ ] Create `lib/database.ts`:
  - `initDB()` - Initialize schema
  - `getDB()` - Get database instance
  - `saveDBToIndexedDB()` - Persist to IndexedDB
  - `loadDBFromIndexedDB()` - Load from IndexedDB on startup
- [ ] Implement schema creation SQL (4 tables)
- [ ] Create `lib/queries.ts`: CRUD operations for all tables
- [ ] Add periodic auto-backup (every 5 minutes)
- [ ] Test: Database persistence across page reloads
- [ ] Test: Handle storage quota exceeded
- [ ] Test: Database initialization on first run

#### 1.3 Type Definitions & Validation (FR-001) (~2-3 hours)
- [ ] Define TypeScript interfaces in `types/okr.ts`
- [ ] Create Zod schemas in `lib/validation.ts`:
  - `objectiveSchema` (title max 200, owner required)
  - `keyResultSchema` (title max 200, metric required)
  - `monthlyDataSchema` (target > 0, actual >= 0)
  - `commentSchema` (max 2000 chars)
- [ ] Test: Validation logic (edge cases, invalid inputs)

#### 1.4 Core Business Logic (~3-4 hours)
- [ ] Implement `lib/calculations.ts`:
  - `calculateStatus(actual, target)` - Green/Orange/Red logic
  - `calculateTrend(current, previous)` - â†‘â†“â†’ with percentage
  - Handle edge cases (target=0, previous=null)
- [ ] Create `lib/utils.ts`:
  - `formatMonth(date)` - Display formatting
  - `generateMonthRange(start, end)` - Month array generator
  - `getCurrentMonth()` - Get current YYYY-MM
- [ ] Implement `lib/initialization.ts`:
  - `initializeMonthlyData(krId, startDate, endDate)` (FR-006)
- [ ] Test: Status calculations (85%, 50% thresholds)
- [ ] Test: Trend calculations (positive, negative, zero, null)
- [ ] Test: Month generation logic

#### 1.5 React Context & Hooks (~3-4 hours)
- [ ] Create `context/DatabaseContext.tsx`:
  - Provides: db instance, isInitialized, error state
  - Handles: DB initialization on mount
- [ ] Create custom hooks:
  - `hooks/useDatabase.ts` - Access DB from context
  - `hooks/useObjectives.ts` - Fetch/create/update/delete objectives
  - `hooks/useKeyResults.ts` - Fetch/create/update/delete KRs
  - `hooks/useMonthlyData.ts` - Fetch/update actuals/targets
  - `hooks/useComments.ts` - Fetch/update comments
- [ ] Test: Hook behavior, data fetching, mutations

#### 1.6 Routing & Layout (~2-3 hours)
- [ ] Install React Router v6
- [ ] Create `App.tsx` with routes:
  - `/` â†’ Dashboard
  - `/admin` â†’ Admin
  - `/tracker` â†’ Tracker
- [ ] Build `components/layout/Navigation.tsx`:
  - Desktop: Horizontal nav bar
  - Mobile: Hamburger menu (Headless UI Disclosure)
- [ ] Build `components/layout/Layout.tsx` (wrapper)
- [ ] Test: Navigation works, active route highlighting

#### 1.7 Admin Page - Objectives & KRs (FR-003) (~8-10 hours)
- [ ] Build `components/Admin/ObjectiveList.tsx`:
  - List all objectives (collapsible/expandable)
  - Select to edit in right panel
- [ ] Build `components/Admin/ObjectiveForm.tsx`:
  - React Hook Form + Zod validation
  - Create/Edit objective fields
  - Delete button with confirmation dialog
- [ ] Build `components/Admin/KeyResultForm.tsx`:
  - Create/Edit KR fields (title, metric, unit)
  - Associate with selected Objective
  - Delete button with confirmation dialog
- [ ] Build `components/Admin/TargetManager.tsx`:
  - Display table of all months
  - Editable target per month
  - Bulk operations: "Copy to all", "Progressive targets"
  - Validation: Target > 0
- [ ] Implement confirmation dialogs (Headless UI Dialog)
- [ ] Add success/error toasts (Sonner)
- [ ] Test: Create objective â†’ Creates with all fields
- [ ] Test: Delete objective â†’ Cascades to KRs and monthly data
- [ ] Test: Set targets â†’ Validates target > 0
- [ ] Test: Validation errors display correctly

#### 1.8 Dashboard View (FR-002) (~6-8 hours)
- [ ] Build `components/Dashboard/MonthSelector.tsx`:
  - Headless UI Listbox (dropdown)
  - Default to current month
- [ ] Build `components/Dashboard/ObjectiveCard.tsx`:
  - Display objective info (title, owner, description)
  - Show monthly comment for selected month
  - List of key results
- [ ] Build `components/Dashboard/KeyResultRow.tsx`:
  - Display KR title, metric, unit
  - Show target and actual for selected month
  - Status badge (Green/Orange/Red)
  - Trend indicator (â†‘12%, â†“5%, â†’0%)
  - "Not Set" badge if target = 0
- [ ] Build `components/Dashboard/Filters.tsx`:
  - Filter by status (Headless UI Combobox)
  - Filter by owner (Headless UI Combobox)
  - Toggle: "Hide unconfigured KRs"
- [ ] Test: Status colors correct (85%, 50% thresholds)
- [ ] Test: Trend calculations display correctly
- [ ] Test: Filters work correctly
- [ ] Test: Month selector updates display

#### 1.9 Tracker Page (FR-004) (~6-8 hours)
- [ ] Build `components/Tracker/MonthSelector.tsx` (same as Dashboard)
- [ ] Build `components/Tracker/ObjectiveSection.tsx`:
  - Collapsible sections per Objective
  - Comment text area (2000 char limit)
- [ ] Build `components/Tracker/KeyResultRow.tsx`:
  - Display KR title, metric
  - Display target (read-only)
  - Editable actual (number input)
  - Individual save button
- [ ] Implement auto-save with debounce:
  - Use `use-debounce` library
  - 500ms delay after last keystroke
  - On blur: flush immediately
  - Visual indicator: "Saving..." â†’ "Saved âœ“"
- [ ] Build "Save All Changes" button (top of page)
- [ ] Implement unsaved changes tracking
- [ ] Add browser warning on navigation with unsaved changes
  - Use `beforeunload` event
- [ ] Add success/error toasts
- [ ] Test: Auto-save triggers after 500ms
- [ ] Test: Individual save buttons work
- [ ] Test: Bulk save button works
- [ ] Test: Browser warning shows when navigating away
- [ ] Test: Comment save (char limit validation)

#### 1.10 Data Persistence Integration (FR-007) (~2 hours)
- [ ] Ensure all mutations call `saveDBToIndexedDB()`
- [ ] Add error handling for save failures
- [ ] Show user-friendly error messages
- [ ] Test: Data persists across browser refreshes
- [ ] Test: Error handling when storage quota exceeded

**Phase 1 Deliverable:** âœ… Working OKR tracker with Admin, Dashboard, Tracker

---

### Phase 2: Enhanced Features
**Goal:** Add backup, reports, and power-user features
**Timeline:** ~30-40 hours

#### 2.1 Data Export/Import (FR-009) (~4-5 hours)
- [ ] Create `hooks/useExport.ts`:
  - `exportToJSON()` - Export with version wrapper
  - `importFromJSON()` - Validate and import
- [ ] Build `components/Admin/ExportImport.tsx`:
  - "Export Data" button â†’ downloads JSON
  - "Import Data" button â†’ file picker + validation
  - Confirmation dialog for import
- [ ] Implement JSON versioning:
  ```json
  {
    "version": "1.0.0",
    "exported_at": "2025-11-24T18:00:00Z",
    "data": { /* all tables */ }
  }
  ```
- [ ] Add schema validation on import
- [ ] Test: Export/import round-trip preserves all data
- [ ] Test: Invalid JSON rejected with error message
- [ ] Test: Version mismatch handling

#### 2.2 PDF Report Generation (FR-005) (~6-8 hours)
- [ ] Install pdfmake + configure fonts
- [ ] Create `lib/pdfGenerator.ts`:
  - `generateOKRReport(month, objectives)` - Main function
  - Header: Title, month, timestamp
  - Summary: Count of objectives, KRs, status breakdown
  - Details: Table per objective with KRs
  - Footer: Page numbers
- [ ] Implement color-coded status in PDF
- [ ] Build `components/Dashboard/ExportPDFButton.tsx`
- [ ] Test: PDF structure correct
- [ ] Test: Data accuracy in PDF
- [ ] Test: Color-coding visible
- [ ] Test: Multi-page PDFs (page breaks work)

#### 2.3 Sample Data (FR-011) (~3-4 hours)
- [ ] Create `lib/sampleData.ts`:
  - 2-3 realistic AEM Cloud Foundation RO objectives
  - 5-8 key results (mix of metrics)
  - Pre-populated actuals for last 2-3 months
  - Sample monthly comments
  - Mix of Green/Orange/Red statuses
- [ ] Build `components/Admin/DataManagement.tsx`:
  - "Load Sample Data" button (confirmation dialog)
  - "Clear All Data" button (strong warning + export prompt)
- [ ] Test: Sample data loads correctly
- [ ] Test: Clear all data works (with confirmation)

#### 2.4 Keyboard Shortcuts (FR-010) (~3-4 hours)
- [ ] Create `hooks/useKeyboardShortcuts.ts`:
  - Global keyboard event listener
  - Route-specific shortcut handlers
- [ ] Implement shortcuts:
  - `Tab` / `Shift+Tab` - Field navigation
  - `Enter` - Save current form
  - `Ctrl/Cmd + S` - Save all (Tracker)
  - `Ctrl/Cmd + E` - Export menu (Admin)
  - `Esc` - Close dialogs
- [ ] Build `components/shared/ShortcutsHelp.tsx`:
  - Modal with shortcut list
  - Trigger: `?` key or Help button
- [ ] Test: All shortcuts work on correct pages
- [ ] Test: Shortcuts don't conflict with browser defaults

#### 2.5 Storage Management (FR-012) (~3-4 hours)
- [ ] Create `lib/storage.ts`:
  - `getStorageUsage()` - Calculate current usage
  - `getStorageQuota()` - Get browser limit
  - `getStoragePercentage()` - Calculate %
- [ ] Build `components/Admin/StorageDisplay.tsx`:
  - Footer display: "Storage: 2.5 MB / ~50 MB"
  - Update on data changes
- [ ] Build `components/shared/StorageWarning.tsx`:
  - Banner at 80% (yellow): "Storage usage high"
  - Banner at 90% (orange): "Storage nearly full"
  - Banner at 95% (red): "Storage critical"
  - Link to export functionality
- [ ] Test: Storage calculation accurate
- [ ] Test: Warnings appear at correct thresholds

#### 2.6 Timeline Configuration (FR-013) (~2-3 hours)
- [ ] Create `lib/config.ts`:
  - Read `VITE_START_DATE`, `VITE_END_DATE` from env
  - Parse and validate dates
  - Default fallback: Oct 2025 - Dec 2026
- [ ] Implement end-of-period detection:
  - Check if current date > END_DATE
- [ ] Build `components/shared/TimelineEndBanner.tsx`:
  - Show when period ended
  - Message: "OKR period ended. Tracker disabled."
  - Admin message: "Update .env to extend timeline"
- [ ] Disable Tracker when past end date
- [ ] Test: Timeline reads from .env correctly
- [ ] Test: End-of-period banner shows
- [ ] Test: Tracker disabled after end date
- [ ] Test: Dashboard/Admin remain functional

#### 2.7 Responsive Design (FR-008) (~4-6 hours)
- [ ] Test and optimize for mobile (375px):
  - Dashboard: Stack cards vertically
  - Admin: Stack panels vertically
  - Tracker: Single column layout
  - Navigation: Hamburger menu
- [ ] Test and optimize for tablet (768px):
  - Dashboard: 2-column card grid
  - Admin: Preserve side-by-side if space allows
  - Tracker: Comfortable spacing
- [ ] Test and optimize for desktop (1024px+):
  - Full multi-column layouts
  - Optimized for 1440px primary use
- [ ] Add responsive breakpoints in Tailwind config
- [ ] Test: All pages on mobile/tablet/desktop
- [ ] Test: Touch interactions on mobile

**Phase 2 Deliverable:** âœ… Feature-complete app with backups, reports, shortcuts

---

### Phase 3: Polish & Production Readiness
**Goal:** Testing, accessibility, performance, deployment
**Timeline:** ~15-20 hours

#### 3.1 Accessibility Audit (NFR-006) (~4-5 hours)
- [ ] Install @axe-core/react for dev warnings
- [ ] Manual testing with screen readers:
  - VoiceOver (macOS)
  - NVDA (Windows) if available
- [ ] Verify WCAG 2.1 AA compliance:
  - Color contrast (status badges, text)
  - Keyboard navigation (all interactive elements)
  - Focus indicators visible
  - ARIA labels on icons and buttons
  - Skip navigation links
- [ ] Fix any accessibility issues found
- [ ] Test: Complete workflow with keyboard only
- [ ] Test: Complete workflow with screen reader

#### 3.2 Browser Compatibility Testing (NFR-005) (~2-3 hours)
- [ ] Test on Chrome 90+ (primary)
- [ ] Test on Edge 90+
- [ ] Test on Firefox 88+
- [ ] Test on Safari 14+ (macOS/iOS)
- [ ] Fix any browser-specific issues
- [ ] Verify sql.js WASM loading on all browsers

#### 3.3 Performance Optimization (NFR-001, NFR-010) (~3-4 hours)
- [ ] Implement code splitting:
  - Use React.lazy() for route components
  - Dynamic imports for heavy libraries (pdfmake)
- [ ] Optimize component rendering:
  - Add React.memo to list items
  - Use useMemo for expensive calculations
- [ ] Test with 50 Objectives Ã— 200 KRs:
  - Dashboard loads < 2 seconds (NFR-001)
  - Tracker saves < 500ms (NFR-001)
  - No UI lag when scrolling
- [ ] Implement virtualization if needed (react-virtual)
- [ ] Run Lighthouse audit, score > 90

#### 3.4 Testing & Coverage (NFR-009) (~4-6 hours)
- [ ] Write unit tests for all business logic:
  - `calculations.test.ts` - Status/trend logic
  - `validation.test.ts` - Zod schemas
  - `utils.test.ts` - Date formatting
  - `queries.test.ts` - Database operations
- [ ] Write integration tests:
  - Create objective â†’ KR auto-initializes monthly data
  - Delete objective â†’ Cascades correctly
  - Export â†’ Import â†’ Data intact
- [ ] Write component tests:
  - Dashboard filters work
  - Tracker auto-save triggers
  - Admin forms validate
- [ ] Run coverage report: `npm run test:coverage`
- [ ] Achieve >= 90% coverage on business logic
- [ ] Achieve >= 70% coverage overall

#### 3.5 Documentation (NFR-008) (~2-3 hours)
- [ ] Create comprehensive README.md:
  - Project overview
  - Prerequisites (Node 20+)
  - Installation instructions
  - Development commands
  - Environment variables
  - Project structure explanation
  - Technology stack
- [ ] Add inline JSDoc comments for complex functions
- [ ] Create DEPLOYMENT.md for Azure setup (Phase 2)
- [ ] Update CHANGELOG.md with release notes

#### 3.6 CI/CD Setup (Phase 2/3) (~3-4 hours)
- [ ] Create `.github/workflows/ci.yml`:
  - Run on push and pull request
  - Jobs: lint, test, build
- [ ] Create `.github/workflows/deploy.yml`:
  - Run on push to main
  - Deploy to Azure Static Web Apps
  - Environment variables via GitHub secrets
- [ ] Test CI/CD pipeline
- [ ] Document deployment process

**Phase 3 Deliverable:** âœ… Production-ready application

---

## Database Schema (sql.js)

```sql
-- Core tables matching FR-001 data model
CREATE TABLE objectives (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL CHECK(length(title) <= 200),
    description TEXT,
    owner TEXT NOT NULL,
    created_date TEXT DEFAULT CURRENT_TIMESTAMP,
    modified_date TEXT DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE key_results (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    objective_id INTEGER NOT NULL,
    title TEXT NOT NULL CHECK(length(title) <= 200),
    metric TEXT NOT NULL CHECK(length(metric) <= 100),
    unit TEXT,
    created_date TEXT DEFAULT CURRENT_TIMESTAMP,
    modified_date TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (objective_id) REFERENCES objectives(id) ON DELETE CASCADE
);

CREATE TABLE monthly_data (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    key_result_id INTEGER NOT NULL,
    month TEXT NOT NULL CHECK(length(month) = 7),  -- Format: YYYY-MM
    target REAL NOT NULL DEFAULT 0 CHECK(target >= 0),
    actual REAL NOT NULL DEFAULT 0 CHECK(actual >= 0),
    last_updated TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (key_result_id) REFERENCES key_results(id) ON DELETE CASCADE,
    UNIQUE(key_result_id, month)
);

CREATE TABLE objective_comments (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    objective_id INTEGER NOT NULL,
    month TEXT NOT NULL CHECK(length(month) = 7),  -- Format: YYYY-MM
    comment TEXT CHECK(length(comment) <= 2000),
    last_updated TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (objective_id) REFERENCES objectives(id) ON DELETE CASCADE,
    UNIQUE(objective_id, month)
);

-- Schema version tracking for future migrations
CREATE TABLE schema_version (
    version INTEGER PRIMARY KEY,
    applied_at TEXT DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO schema_version (version) VALUES (1);
```

---

## Project Structure

```
AEMCFRO-OKRs/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx                      # Entry point
â”‚   â”œâ”€â”€ App.tsx                       # Root component, routing
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Dashboard/
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx         # Main dashboard page
â”‚   â”‚   â”‚   â”œâ”€â”€ MonthSelector.tsx     # Month dropdown
â”‚   â”‚   â”‚   â”œâ”€â”€ ObjectiveCard.tsx     # Objective card display
â”‚   â”‚   â”‚   â”œâ”€â”€ KeyResultRow.tsx      # KR with status/trend
â”‚   â”‚   â”‚   â”œâ”€â”€ Filters.tsx           # Status/owner filters
â”‚   â”‚   â”‚   â””â”€â”€ ExportPDFButton.tsx   # PDF export
â”‚   â”‚   â”œâ”€â”€ Admin/
â”‚   â”‚   â”‚   â”œâ”€â”€ Admin.tsx             # Main admin page
â”‚   â”‚   â”‚   â”œâ”€â”€ ObjectiveList.tsx     # Left panel list
â”‚   â”‚   â”‚   â”œâ”€â”€ ObjectiveForm.tsx     # Create/edit objective
â”‚   â”‚   â”‚   â”œâ”€â”€ KeyResultForm.tsx     # Create/edit KR
â”‚   â”‚   â”‚   â”œâ”€â”€ TargetManager.tsx     # Set monthly targets
â”‚   â”‚   â”‚   â”œâ”€â”€ ExportImport.tsx      # Backup/restore
â”‚   â”‚   â”‚   â”œâ”€â”€ DataManagement.tsx    # Sample/clear data
â”‚   â”‚   â”‚   â””â”€â”€ StorageDisplay.tsx    # Storage usage
â”‚   â”‚   â”œâ”€â”€ Tracker/
â”‚   â”‚   â”‚   â”œâ”€â”€ Tracker.tsx           # Main tracker page
â”‚   â”‚   â”‚   â”œâ”€â”€ MonthSelector.tsx     # Month dropdown
â”‚   â”‚   â”‚   â”œâ”€â”€ ObjectiveSection.tsx  # Collapsible section
â”‚   â”‚   â”‚   â”œâ”€â”€ KeyResultRow.tsx      # Editable actuals
â”‚   â”‚   â”‚   â””â”€â”€ CommentBox.tsx        # Monthly comment
â”‚   â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx            # Reusable button
â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx             # Form input
â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.tsx             # Dialog wrapper
â”‚   â”‚   â”‚   â”œâ”€â”€ StatusBadge.tsx       # Green/Orange/Red
â”‚   â”‚   â”‚   â”œâ”€â”€ TrendIndicator.tsx    # â†‘â†“â†’ with %
â”‚   â”‚   â”‚   â”œâ”€â”€ ConfirmDialog.tsx     # Confirmation modal
â”‚   â”‚   â”‚   â”œâ”€â”€ ShortcutsHelp.tsx     # Keyboard shortcuts
â”‚   â”‚   â”‚   â”œâ”€â”€ StorageWarning.tsx    # Storage alerts
â”‚   â”‚   â”‚   â””â”€â”€ TimelineEndBanner.tsx # Period ended notice
â”‚   â”‚   â””â”€â”€ layout/
â”‚   â”‚       â”œâ”€â”€ Layout.tsx            # Main layout wrapper
â”‚   â”‚       â”œâ”€â”€ Navigation.tsx        # Nav bar
â”‚   â”‚       â””â”€â”€ Header.tsx            # Page header
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ database.ts               # sql.js wrapper
â”‚   â”‚   â”œâ”€â”€ queries.ts                # SQL CRUD operations
â”‚   â”‚   â”œâ”€â”€ calculations.ts           # Status/trend logic
â”‚   â”‚   â”œâ”€â”€ validation.ts             # Zod schemas
â”‚   â”‚   â”œâ”€â”€ utils.ts                  # Helpers
â”‚   â”‚   â”œâ”€â”€ initialization.ts         # Monthly data init
â”‚   â”‚   â”œâ”€â”€ pdfGenerator.ts           # PDF report
â”‚   â”‚   â”œâ”€â”€ sampleData.ts             # Demo data
â”‚   â”‚   â”œâ”€â”€ storage.ts                # Storage monitoring
â”‚   â”‚   â””â”€â”€ config.ts                 # Env config
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useDatabase.ts            # DB access
â”‚   â”‚   â”œâ”€â”€ useObjectives.ts          # Objective CRUD
â”‚   â”‚   â”œâ”€â”€ useKeyResults.ts          # KR CRUD
â”‚   â”‚   â”œâ”€â”€ useMonthlyData.ts         # Monthly data CRUD
â”‚   â”‚   â”œâ”€â”€ useComments.ts            # Comments CRUD
â”‚   â”‚   â”œâ”€â”€ useExport.ts              # Export/import
â”‚   â”‚   â”œâ”€â”€ useKeyboardShortcuts.ts   # Keyboard handling
â”‚   â”‚   â””â”€â”€ useAutoSave.ts            # Auto-save logic
â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â””â”€â”€ DatabaseContext.tsx       # DB singleton
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ okr.ts                    # Data types
â”‚   â”‚   â””â”€â”€ database.ts               # DB types
â”‚   â””â”€â”€ tests/
â”‚       â”œâ”€â”€ lib/
â”‚       â”‚   â”œâ”€â”€ calculations.test.ts
â”‚       â”‚   â”œâ”€â”€ validation.test.ts
â”‚       â”‚   â”œâ”€â”€ utils.test.ts
â”‚       â”‚   â””â”€â”€ queries.test.ts
â”‚       â”œâ”€â”€ hooks/
â”‚       â”‚   â””â”€â”€ useAutoSave.test.ts
â”‚       â””â”€â”€ components/
â”‚           â”œâ”€â”€ Dashboard.test.tsx
â”‚           â”œâ”€â”€ Admin.test.tsx
â”‚           â””â”€â”€ Tracker.test.tsx
â”œâ”€â”€ public/
â”‚   â””â”€â”€ sql-wasm.wasm                 # sql.js WASM file
â”œâ”€â”€ .env.example                      # Environment template
â”œâ”€â”€ .env                              # Local config (gitignored)
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml                    # CI pipeline
â”‚       â””â”€â”€ deploy.yml                # CD pipeline (Phase 2)
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vitest.config.ts
â”œâ”€â”€ .eslintrc.json
â”œâ”€â”€ .prettierrc
â””â”€â”€ README.md
```

---

## Initial package.json Dependencies

```json
{
  "name": "aemcfro-okrs",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "test": "vitest",
    "test:coverage": "vitest --coverage",
    "lint": "eslint . --ext ts,tsx",
    "format": "prettier --write \"src/**/*.{ts,tsx,css}\""
  },
  "dependencies": {
    "react": "^18.3.0",
    "react-dom": "^18.3.0",
    "react-router-dom": "^6.22.0",
    "react-hook-form": "^7.50.0",
    "@hookform/resolvers": "^3.3.0",
    "zod": "^3.22.0",
    "@headlessui/react": "^1.7.0",
    "@heroicons/react": "^2.1.0",
    "sql.js": "^1.10.0",
    "pdfmake": "^0.2.0",
    "date-fns": "^3.3.0",
    "use-debounce": "^10.0.0",
    "sonner": "^1.4.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "@types/sql.js": "^1.4.0",
    "@vitejs/plugin-react": "^4.2.0",
    "vite": "^5.1.0",
    "typescript": "^5.3.0",
    "vitest": "^1.3.0",
    "@testing-library/react": "^14.2.0",
    "@testing-library/user-event": "^14.5.0",
    "@testing-library/jest-dom": "^6.4.0",
    "@vitest/coverage-v8": "^1.3.0",
    "tailwindcss": "^3.4.0",
    "postcss": "^8.4.0",
    "autoprefixer": "^10.4.0",
    "eslint": "^8.56.0",
    "prettier": "^3.2.0",
    "@typescript-eslint/eslint-plugin": "^7.0.0",
    "@typescript-eslint/parser": "^7.0.0",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.0"
  }
}
```

**Total bundle size estimate:** ~200-250KB gzipped

---

## Updated Acceptance Criteria

âœ… **Implementation is complete when:**

### Functional Completeness
- [ ] All 13 FR IDs mapped and implemented
- [ ] No features beyond REQUIREMENTS.md implemented (OOS respected)
- [ ] All 3 pages functional: Dashboard, Admin, Tracker
- [ ] Data persists across browser refreshes
- [ ] Export/import works correctly

### Code Quality (NFR-007)
- [ ] No linter errors: `npm run lint`
- [ ] Code formatted: `npm run format`
- [ ] Type checking passes: `tsc --noEmit`
- [ ] All components modular and reusable
- [ ] TypeScript strict mode enabled

### Testing (NFR-009)
- [ ] All tests passing: `npm run test`
- [ ] Coverage >= 90% for business logic (lib/)
- [ ] Coverage >= 70% overall
- [ ] Integration tests for critical flows
- [ ] Component tests for key UI interactions

### Performance (NFR-001)
- [ ] Dashboard loads all OKRs within 2 seconds
- [ ] Tracker saves updates within 500ms
- [ ] No lag with 50 Objectives Ã— 200 KRs
- [ ] Lighthouse score > 90

### Accessibility (NFR-006)
- [ ] WCAG 2.1 Level AA compliance verified
- [ ] Keyboard navigation works throughout
- [ ] Screen reader testing completed
- [ ] Focus indicators visible
- [ ] Color contrast meets standards

### Browser Support (NFR-005)
- [ ] Tested on Chrome 90+
- [ ] Tested on Edge 90+
- [ ] Tested on Firefox 88+
- [ ] Tested on Safari 14+

### Documentation (NFR-008)
- [ ] README.md with setup instructions
- [ ] Inline JSDoc for complex functions
- [ ] All module READMEs updated
- [ ] CHANGELOG.md current

### Validation Gate
- [ ] `python3 tools/requirements_guard.py` passes
- [ ] All NFR requirements met
- [ ] User acceptance testing completed

---

## Risk Mitigation

### Technical Risks

| Risk | Impact | Mitigation |
|------|--------|------------|
| **Browser storage quota exceeded** | High | Storage warnings, export prompts, usage monitoring |
| **sql.js performance with large datasets** | Medium | Tested with 50 Obj Ã— 200 KRs, indexing, query optimization |
| **WASM loading failures** | Medium | Error handling, fallback messages, browser compatibility tests |
| **Data corruption on import** | High | Schema validation, rollback on error, version checking |
| **Auto-save conflicts** | Low | Debounce strategy, explicit save on blur, transaction handling |

### User Experience Risks

| Risk | Impact | Mitigation |
|------|--------|------------|
| **Data loss on browser clear** | High | Prominent export/backup reminders, periodic prompts |
| **Confusion about data location** | Medium | Clear messaging that data is local-only |
| **Accidental deletion** | Medium | Confirmation dialogs, export prompt before delete |
| **Performance degradation** | Low | Testing at scale, virtualization if needed |

---

## Next Steps (Priority Order)

### Immediate (Start Now)
1. âœ… Review this updated implementation plan
2. **Initialize project** - Run Phase 1.1 (Project Setup)
3. **Set up database** - Run Phase 1.2 (Database Layer)
4. **Create types & validation** - Run Phase 1.3

### Short Term (This Week)
5. Implement core business logic - Phase 1.4
6. Build React infrastructure - Phase 1.5-1.6
7. Start on Admin page - Phase 1.7

### Medium Term (Next 2 Weeks)
8. Complete Dashboard - Phase 1.8
9. Complete Tracker - Phase 1.9
10. Test Phase 1 deliverable

### Long Term (Month 2)
11. Implement Phase 2 features
12. Complete Phase 3 polish
13. Deploy to Azure Static Web Apps

---

**Ready to begin Phase 1.1: Project Setup!** ðŸš€
